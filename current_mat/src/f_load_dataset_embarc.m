% diagnosis keys:
% 1 = CONTROL
% 2 = MDD
function params = load_dataset_embarc( classes_ )
    ica_path = '/data/collaboration/NeuroMark2/Results/ICA/EMBARC/'
    ic_labels_path = '../results/neuromark_ic_labels.csv'
    % this is manually generated by resolving the ICA selected subject list and the OSUCH diagnosis spreadsheet
    sub_info_file = '/data/collaboration/NeuroMark2/Data/EMBARC/phenotypes/ndar_subject01.txt'
    ica_sub_file = '/data/collaboration/NeuroMark2/Results/ICA/EMBARC/EMBARCSubject.mat'
    
    % get number of voxels from param file
    sesInfo = strip( ls( [ica_path '*param*'] ) );
    sesInfo = load( sesInfo );
    sesInfo = sesInfo.sesInfo;
    n_voxels = numel( sesInfo.mask_ind );

    % grab the domain labels
    ic_labels = readcell( ic_labels_path );
    domains = unique( sort( ic_labels(:,2) ) )
    n_domains = length( domains );

    % grab the subject labels
    ica_sub = load( ica_sub_file );
    ica_sub = ica_sub.files;
    participants_ = readtable( sub_info_file, 'FileType', 'text' );
    y = {};
    for ii = 1:length( ica_sub )
        sub_id = strsplit( ica_sub(ii).name(1,:), '/' );
        sub_id = sub_id{9}(1:6);
        idx = find( strcmp( participants_.src_subject_id, sub_id ), 1 );
        assert( numel(idx) < 2 ) % check for duplicate subject ID
        y = [y; participants_(idx,:).phenotype];
    end
    y = double( categorical( y ) );
    sub_idx = 1:length( y );
    % handle classes input
    if ~isempty( classes_ )
        classes_ = str2num( classes_ );
        class_idx = find( ismember(y, classes_) );
        embarc_sites = getenv( 'EMBARC_SITES' );
        if embarc_sites
            embarc_sites = strsplit( embarc_sites, ',' )
            site_idx = find( contains( participants_.src_subject_id, embarc_sites ) );
            sub_idx = intersect( class_idx, site_idx );
            y = y( sub_idx );
        else
            sub_idx = class_idx;
            y = y( sub_idx );
        end
    end
    disp( sub_idx )
    disp( length( sub_idx ) )
    disp( ['classes: '] )
    unique(y)

    file_pat = fullfile( ica_path, [sesInfo.userInput.prefix '_ica_c$1-1.mat'] )

    % return values
    params.ica_path = ica_path;
    params.file_pat = file_pat;
    params.y = y;
    params.n_voxels = n_voxels;
    params.ic_labels = ic_labels;
    params.domains = domains;
    % selct particular subjects from ICA result
    params.sub_idx = sub_idx;
    
    